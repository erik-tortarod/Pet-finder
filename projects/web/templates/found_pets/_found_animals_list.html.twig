{% for foundAnimal in foundAnimals %}
	{% set animal = foundAnimal.animalId %}
	{% set user = foundAnimal.userId %}
	{% set primaryPhoto = animal.animalPhotos|filter(photo => photo.isPrimary)|first %}
	{% set tags = animal.animalTags|map(tag => tag.tagId.name)|join(', ') %}

	{% if animal.status == 'FOUND' or animal.status == 'UNDER_PROTECTION' %}
		<article class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow cursor-pointer"
			data-controller="pet-card"
			data-action="click->pet-card#navigateToPet"
			data-pet-card-url-value="{{ path('app_animal_show_slug', {'id': animal.id, 'slug': animal.generateSlug()}) }}">
			<div class="relative">
				{% if primaryPhoto %}
					<img src="{{ asset(primaryPhoto.filePath) }}" alt="{% if animal.name %}{{ animal.name }}{% else %}{{ animal.description }}{% endif %}" class="w-full h-48 object-cover"/>
				{% else %}
					<div class="w-full h-48 bg-gradient-to-r from-green-100 to-green-200 flex items-center justify-center">
						{% set iconClass = animal.animalType|lower == 'perro' ? 'fa-dog' : (animal.animalType|lower == 'gato' ? 'fa-cat' : (animal.animalType|lower == 'ave' ? 'fa-dove' : (animal.animalType|lower == 'conejo' ? 'fa-feather' : 'fa-paw'))) %}
						<i class="fas {{ iconClass }} text-4xl text-green-600"></i>
					</div>
				{% endif %}

				{# Etiqueta de estado (esquina superior derecha) #}
				<div class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-medium">{{ animal_status_label(animal.status) }}</div>

				{# Etiqueta de protectora (esquina superior izquierda) - solo si está bajo custodia #}
				{% if animal.status == 'UNDER_PROTECTION' and user.isShelter %}
					<div class="absolute top-2 left-2 bg-purple-600 text-white px-2 py-1 rounded-full text-xs font-medium flex items-center">
						{% include 'components/Icon.html.twig' with {name: 'shield', size: 12, class: 'mr-1'} %}
						{{ user.shelterName|default('Protectora') }}
					</div>
				{% endif %}
			</div>

			<div class="p-4">
				<h3 class="text-lg font-semibold text-gray-900 mb-4">{{ (animal.description ?? '')|highlight(filters.search|default('')) }}</h3>
				<p class="text-sm text-gray-600 mb-2">
					{% if animal.name %}
						<span class="font-bold">{{ (animal.name ?? '')|highlight(filters.search|default('')) }}</span>
						•
					{% endif %}
					{{ (animal.animalType ?? '')|capitalize|highlight(filters.search|default('')) }}
					•
					{% if animal.gender == 'male' %}{{ 'found_pets.list.male'|trans }}{% elseif animal.gender == 'female' %}{{ 'found_pets.list.female'|trans }}{% else %}{{ 'found_pets.list.unspecified'|trans }}
					{% endif %}
					{% if animal.age %}
						•
						{{ (animal.age ?? '')|highlight(filters.search|default('')) }}
					{% endif %}
				</p>

				{% if tags %}
					<div class="flex flex-wrap gap-1 mb-3">
						{% for tag in animal.animalTags %}
							<span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded">{{ (tag.tagId.name ?? '')|highlight(filters.search|default('')) }}</span>
						{% endfor %}
					</div>
				{% endif %}

				<div class="flex items-center justify-between">
					<span class="text-sm text-gray-500">
						{% include 'components/Icon.html.twig' with {name: 'map-pin', size: 14, class: 'inline mr-1'} %}{{ (foundAnimal.foundZone ?? '')|capitalize|highlight(filters.search|default('')) }}
					</span>
					<span class="text-sm text-gray-500">
						{% set daysAgo = (date()|date('U') - foundAnimal.createdAt|date('U')) / 86400 %}
						{% if daysAgo < 1 %}{{ 'found_pets.list.today'|trans }}{% elseif daysAgo < 2 %}{{ 'found_pets.list.yesterday'|trans }}{% elseif daysAgo < 7 %}{{ 'found_pets.list.days_ago'|trans({'%days%': daysAgo|round(0, 'floor')}) }}{% else %}{{ 'found_pets.list.weeks_ago'|trans({'%weeks%': (daysAgo / 7)|round(0, 'floor')}) }}
						{% endif %}
					</span>
				</div>

				<div class="mt-3 flex gap-2">
					<button class="flex-1 bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 transition-colors"
							data-action="click->pet-card#openContactModal"
							data-pet-name="{% if animal.name %}{{ animal.name }}{% else %}{{ animal.description }}{% endif %}"
							data-phone="{{ user.phone ?? 'No disponible' }}"
							data-email="{{ user.email }}">
						{% include 'components/Icon.html.twig' with {name: 'whatsapp', size: 16, class: 'inline mr-2'} %}{{ 'found_pets.list.contact'|trans }}
					</button>
					<button class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors"
							data-action="click->pet-card#copyLink"
							data-url="{{ path('app_animal_show_slug', {'id': animal.id, 'slug': animal.generateSlug()}) }}">
						{% include 'components/Icon.html.twig' with {name: 'share', size: 16, class: 'inline mr-2'} %}{{ 'found_pets.list.share'|trans }}
					</button>
				</div>
			</div>
		</article>
	{% endif %}
{% endfor %}
